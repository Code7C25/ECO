<!DOCTYPE html>
<html lang="es">
<head>
  <!-- Configuraci√≥n b√°sica y conexi√≥n a Firebase -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ECO - Acceso Psic√≥logo</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
</head>

<body>
  <!-- Men√∫ principal -->
  <div class="menu-icon" onclick="toggleMenu()">‚ãÆ</div>
  <ul id="menu" class="menu-hidden">
    <li><a href="herramientas.html">Herramientas propias</a></li>
    <li><a href="diario.html">Mi diario personal</a></li>
  </ul>

  <main>
    <h2>Acceso para psic√≥logos</h2>

    <!-- Formulario de inicio de sesi√≥n -->
    <div id="psicoForm">
      <input id="psicoDNI" type="text" placeholder="DNI" />
      <input id="psicoClave" type="password" placeholder="Contrase√±a" />
      <button id="psicoBtn">Ingresar</button>
      <p id="psicoMsg"></p>
    </div>

    <!-- Mensaje de acceso denegado -->
    <div id="psicoDenied" style="display:none; text-align:center;">
      <h3>Acceso denegado</h3>
      <p>No ten√©s permisos para ver esta secci√≥n.</p>
      <button onclick="window.location.href='index.html'">Volver</button>
    </div>
  </main>

  <!-- Scripts generales -->
  <script src="menu.js"></script>
  <script src="firebase.js"></script>

  <!-- Bot√≥n para volver al inicio -->
  <button onclick="window.location.href='index.html'">
      üè† P√°gina principal
  </button>

  <!-- Script de validaci√≥n de acceso -->
  <script>
  document.getElementById("psicoBtn").addEventListener("click", async () => {
    const dni = document.getElementById("psicoDNI").value.trim();
    const clave = document.getElementById("psicoClave").value.trim();
    const msg = document.getElementById("psicoMsg");
    const denied = document.getElementById("psicoDenied");
    const form = document.getElementById("psicoForm");

    msg.textContent = "";
    msg.style.color = "red";

    // Validaci√≥n del DNI 
    if (!/^\d{7,8}$/.test(dni)) {
      msg.textContent = "El DNI debe tener solo n√∫meros (7 u 8 d√≠gitos).";
      return;
    }

    //Validaci√≥n de la contrase√±a
    if (clave.length < 6) {
      msg.textContent = "La contrase√±a debe tener al menos 6 caracteres.";
      return;
    }

    try {
      //Consulta en la base de datos para validar credenciales
      const query = await firebase.firestore()
        .collection("psicologos")
        .where("dni", "==", dni)
        .where("clave", "==", clave)
        .get();

      // Si el acceso es correcto
      if (!query.empty) {
        msg.style.color = "green";
        msg.textContent = "Acceso concedido ‚úÖ";
        localStorage.setItem("psicoDNI", dni);

        setTimeout(() => {
          window.location.href = "psicologo_panel.html"; 
        }, 1000);
      } else {
        <!-- Si no coincide, muestra el mensaje de acceso denegado -->
        form.style.display = "none";
        denied.style.display = "block";
      }
    } catch (error) {
      msg.textContent = "Error al conectar con la base de datos.";
    }
  });
  </script>

</body>
</html>
